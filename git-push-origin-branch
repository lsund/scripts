#!/bin/zsh

branch_name=$(git branch | grep \* | cut -d ' ' -f2)

project_name=$(echo $branch_name | cut -d '-' -f1)
issue_number=$(echo $branch_name | cut -d '-' -f2)

changes_status=$(git status | tail -1 | cut -d' ' -f1-5)

if [[ $1 == "-n" ]]; then
    nocommit=true
else
    msg=$1
fi


if [[ "$changes_status" == "no changes added to commit" ||
       $changes_status == "nothing added to commit but" &&
       $nocommit == "true" ]]; then
    git status
    vared -p  "Some stuff not yet added. Add everything? [Y/n] " -c choice
    if [[ "$choice" == "n" ]]; then
        echo "OK."
    else
        git add --all
    fi
fi


if [[ $project_name == "HER" || $project_name == "DI" ]]; then
    commit_tag="$project_name-$issue_number: "
fi

if [[ $1 == "--nocommit" || $1 == "-n" ]]; then
    echo  "git push -u origin $branch_name"
    git push -u origin $branch_name
else
    if [[ ! $msg ]]; then
        vared -p "Commit Message: " -c msg
    fi
    echo git commit -m "$commit_tag$msg"
    git commit -m "$commit_tag$msg"
    if [[ $? == "0" ]]; then
        echo  "git push -u origin $branch_name"
        git push -u origin $branch_name
    else
        echo "Commit unsuccessful"
    fi
fi
