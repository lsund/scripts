#!/bin/zsh

# For gui programs intended to be run in shell background

for var in "$@"
do
    cmd="$cmd $var"
done


# ############################################################################
# Find out which program to use

case $1 in
    "zath")
        program=$(which zathura)
        [[ $? == "1" ]] && echo "zathura is not installed" && exit 1
        ;;
    "pdf")
        program=$(which zathura)
        [[ $? == "1" ]] && echo "zathura is not installed" && exit 1
        ;;
    "eclipse")
        which eclipse > /dev/null
        [[ $? == "1" ]] && echo "eclipse is not installed" && exit 1
        program="$(SWT_GTK3=0 /usr/bin/eclipse >/dev/null 2>&1 &)"
        # [[ $? == "1" ]] && echo "eclipse is not installed" && exit 1
        ;;
    "mir")
        program=$(which mirage)
        [[ $? == "1" ]] && echo "mirage is not installed" && exit 1
        ;;
    "img")
        program=$(which mirage)
        [[ $? == "1" ]] && echo "mirage is not installed" && exit 1
        ;;
    "emacs")
        program=/usr/local/bin/emacs
        [[ $? == "1" ]] && echo "emacs is not installed" && exit 1
        ;;
    "gimp")
        program=$(which gimp)
        [[ $? == "1" ]] && echo "gimp is not installed" && exit 1
        ;;
    *)
        echo "Unknown command: $1" && exit 1
esac

# Count arguments, expanding wildcards etc
words=$(echo $cmd | wc -w)

# ############################################################################
# Launch program with arguments

case $words in
    1)
        $program > /dev/null 2>&1 &
        ;;
    2)
        if [[ $2 == "first" ]]; then
            $program $(ls -1 | head -1) > /dev/null 2>&1 &
        else
            $program $2 > /dev/null 2>&1 &
        fi
        ;;
    *)
        msg1="You've chosen to spawn $(basename $program) "
        msg2="on $(( $words - 1 )) files. Proceed? [y/n] "
        vared -p "$msg1$msg2" -c yn
        case $yn in
            [Yy]*)
                for file in $(echo $cmd | cut -d' ' -f3-)
                do
                    if [[ -f $file ]]; then
                        $program $file  > /dev/null 2>&1 &
                    else
                        echo "Can't open file: $file " && exit
                    fi
                done
                ;;
            [Nn]*)
                echo "O-kay"
                ;;
            *) echo "yes or no mate"
        esac
esac
